import { useNavigate } from "react-router-dom"
import { useCharacterStore } from "../../../stores/characterStore"
import './CharacterSheet.css'
import DraggableItem from "./DraggableItem"
import { useState } from "react";
import { closestCenter, DndContext, DragOverlay, PointerSensor, useSensor, useSensors, type DragStartEvent, type DragEndEvent, } from "@dnd-kit/core";
import type { Accessory, Armor, Consumable, Equipment, Weapon } from "../../../types/inventory.types";
import EquipmentSlot from "./EquipmentSlot";
import { ITEM_IMAGES } from "../../../utils/data/items/starterGear";
import { canEquipItem } from "../../../utils/generators/items-builder";
import { Button, Divider, Tooltip, } from 'antd';
import Inventory from "./Inventory";
import Stats from "./CombatStats";
import StatusBars from "./StatusBars";
import ModalDelete from "./ModalDelete";

export default function CharacterSheet() {
    const { reset,
        equipment,
        inventory,
        equipItem,
        swapEquipment,
        unequipItem,
        moveInventoryItem,
        selectedClass,
        currency,
        craftingMaterials
    } = useCharacterStore();
    const [activeId, setActiveId] = useState<string | null>(null);
    const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);

    const toggleDeleteModal = (open: boolean) => {
        setIsDeleteModalOpen(open);
    };
    const navigate = useNavigate();

    const sensors = useSensors(useSensor(PointerSensor));

    const findItemWithSource = (id: string): { item: Weapon | Armor | Accessory | Consumable; source: string } | null => {

        const separatorIndex = id.lastIndexOf('|');
        if (separatorIndex === -1) return null;

        const itemId = id.substring(0, separatorIndex);
        const sourceFromId = id.substring(separatorIndex + 1);

        if (sourceFromId.startsWith('inventory-')) {
            const index = parseInt(sourceFromId.replace('inventory-', ''));
            if (inventory[index]?.item?.id === itemId) {
                return { item: inventory[index].item!, source: sourceFromId };
            }
        } else if (sourceFromId.startsWith('equipment-')) {
            const slot = sourceFromId.replace('equipment-', '') as keyof Equipment;
            if (equipment[slot]?.id === itemId) {
                return { item: equipment[slot]!, source: sourceFromId };
            }
        }

        for (const [slot, item] of Object.entries(equipment)) {
            if (item?.id === itemId) {
                return { item, source: `equipment-${slot}` };
            }
        }

        for (let i = 0; i < inventory.length; i++) {
            if (inventory[i].item?.id === itemId) {
                return { item: inventory[i].item!, source: `inventory-${i}` };
            }
        }

        return null;
    };

    const activeItemData = activeId ? findItemWithSource(activeId) : null;

    const handleDragStart = (event: DragStartEvent) => {
        setActiveId(event.active.id.toString())
    };

    const handleDragEnd = (event: DragEndEvent) => {
        const { active, over } = event;

        if (!over) {
            setActiveId(null);
            return;
        }

        const activeItemData = findItemWithSource(active.id.toString());

        if (!activeItemData) {
            setActiveId(null);
            return;
        }

        const targetZone = over.id as string;
        handleItemMove(activeItemData, targetZone);
        setActiveId(null);
    };

    const handleItemMove = (draggedItem: { item: Weapon | Armor | Accessory | Consumable; source: string }, targetZone: string) => {

        if (targetZone.startsWith('equipment-')) {
            const equipmentSlot = targetZone.replace('equipment-', '') as keyof Equipment;
            if (canEquipItem(draggedItem.item, equipmentSlot)) {
                moveToEquipment(draggedItem, equipmentSlot);
            }
        } else if (targetZone.startsWith('inventory-')) {
            const inventoryIndex = parseInt(targetZone.replace('inventory-', ''));

            if (inventoryIndex >= 0 && inventoryIndex < inventory.length) {
                const targetSlot = inventory[inventoryIndex];

                if (targetSlot && !targetSlot.item) {
                    moveToInventorySlot(draggedItem, inventoryIndex);
                }
            }
        }
    };

    const moveToEquipment = (draggedItem: { item: Weapon | Armor | Accessory | Consumable; source: string }, targetSlot: keyof Equipment) => {
        if (draggedItem.source.startsWith('inventory-')) {
            const fromIndex = parseInt(draggedItem.source.replace('inventory-', ''));
            equipItem(fromIndex, targetSlot);
        } else {
            const fromSlot = draggedItem.source.replace('equipment-', '') as keyof Equipment;
            swapEquipment(fromSlot, targetSlot);
        }
    };

    const moveToInventorySlot = (draggedItem: { item: Weapon | Armor | Accessory | Consumable; source: string }, targetIndex: number) => {
        if (draggedItem.source.startsWith('equipment-')) {
            const fromSlot = draggedItem.source.replace('equipment-', '') as keyof Equipment;

            if (targetIndex >= 0 && targetIndex < inventory.length && !inventory[targetIndex].item) {
                unequipItem(fromSlot, targetIndex);
            }
        }
        else if (draggedItem.source.startsWith('inventory-')) {
            const fromIndex = parseInt(draggedItem.source.replace('inventory-', ''));
            moveInventoryItem(fromIndex, targetIndex);
        }
    };

    const handleReset = () => {
        reset()
        navigate('/play')
    };

    return (
        <div className="characterSheet-container">
            <div className="ui-element1"></div>
            <div className="ui-element2"></div>
            <div className="ui-element3"></div>
            <div className="ui-element4"></div>
            <div className="ui-element5"></div>
            <DndContext
                sensors={sensors}
                collisionDetection={closestCenter}
                onDragStart={handleDragStart}
                onDragEnd={handleDragEnd}
            >
                <div className="divider-wrapper">
                    <Divider style={{ borderColor: 'white', color: 'white', margin: 0, fontFamily: 'Cormorant', fontSize: '2.2vh' }}>{selectedClass?.name}</Divider>
                    {/* <div className="character-level-wrapper">
                        <span>Ур: {level}</span>
                        <div className="ui-element-level"></div>
                    </div> */}
                    <div className="character-sheet-currency-wrapper">
                        <p className="character-sheet-currency-gold">{currency.gold}</p>
                        <p className="character-sheet-currency-souls">{currency.souls}</p>
                        <p className="character-sheet-currency-fame">{currency.fame}</p>
                    </div>
                </div>

                <div className="equipment-section">
                    <div className="equipment-grid">
                        <img className="character-sheet-img" src={selectedClass?.img} alt="" draggable={false} />
                        {(Object.keys(equipment) as (keyof Equipment)[]).map((slot) => (
                            <EquipmentSlot key={slot} slotType={slot} data-slot={slot}>
                                {equipment[slot] && (
                                    <DraggableItem item={equipment[slot]} location={`equipment-${slot}`} />
                                )}
                            </EquipmentSlot>
                        ))}
                    </div>
                </div>

                <StatusBars />
                <Stats />
                <Inventory />

                <div className="character-sheet-box-materials">
                    <div className="character-sheet-materials">
                        <div className="character-sheet-materials-wrapper">
                            <Tooltip placement="top" title={'Древесина'}>
                                <div className="character-sheet-material">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="2vh" height="2vh" viewBox="0 0 128 128"><path fill="#633D35" d="m37.29 113.26l-8.42 4.48V97.58l10.52 11.2z" /><path fill="#AD7156" d="M99.99 19.95c0 3.02.51 21.49.51 21.49s.26 1.98 1.75 2.48c.98.33 3.12-.37 5.73-2.41c.35-.27.82-.31 1.2-.09c1 .6 3.15 1.77 4.5 5.32c1.49 3.92 1.21 7.22.98 8.62c-.08.47-.3.9-.57 1.24c-2.43 3-14.59 18.58-14.59 28.48c0 0 .2 14.45.2 22.95c0 7.75-13.09 14.22-30.49 15.72l-9.71-2.67l-11.2 2.01c-3.56-.55-6.88-1.31-9.86-2.25l-7.47-21.02l-2.1 17.92s-5.61-5.75-5.61-9.71c0-8.57-2.1-88.03-2.1-88.03l78.83-.05z" /><linearGradient id="notoWood0" x1="102.035" x2="102.017" y1="43.768" y2="43.832" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#CE8963" /><stop offset="1" stop-color="#D08A61" stop-opacity="0" /></linearGradient><path fill="url(#notoWood0)" d="M102.25 43.91z" /><path fill="#CE8963" d="M47 35.58c-.33 5.56-.91 11.07-1.53 16.57l-.93 8.23c-.29 2.74-.67 5.45-.59 8.08c0 2.7.13 5.46.27 8.21l.37 8.28c.24 5.53.45 11.06.41 16.63c-1.2-5.44-2.05-10.93-2.74-16.44c-.68-5.52-1.21-11.02-1.31-16.67c-.02-2.91.4-5.71.78-8.46c.44-2.75.88-5.49 1.43-8.21c1.07-5.45 2.29-10.86 3.84-16.22zm-13 28c.27.7.3 1.46.38 2.19c.05.74.1 1.48.12 2.22c.04 1.48.06 2.96.04 4.44c-.02 2.96-.13 5.91-.29 8.86c-.15 2.95-.35 5.89-.59 8.83c-.21 2.94-.52 5.88-.81 8.82l-.03-.36l1.42 5.21l1.35 5.23c.87 3.5 1.7 7 2.41 10.55c-1.32-3.36-2.52-6.77-3.68-10.18l-1.7-5.13L31 99.13l-.05-.16l.02-.19c.25-2.93.46-5.87.74-8.81c.25-2.93.53-5.87.82-8.8l.89-8.79l.43-4.4c.07-.73.13-1.47.18-2.2c.02-.73.12-1.47-.03-2.2zm24.5 32.5v25l8 2s-5-15-8-27z" /><path fill="#965B44" d="M88.5 79.08c5.68-12.95 25.68-26.93 25.68-26.93l.59-.43c.11 1.76.02 3.04-.14 3.74c-.07.31-.3.82-.46 1.01c-1.92 2.36-14.67 18.42-14.67 28.6c0 0 .2 14.45.2 22.95c0 3.81-4.2 9.05-13.2 12.05l4-29l-9 9c0 .01 3.01-11.88 7-20.99zm12-38.29c.26 4.05 3.08 3.13 3.08 3.13c-3.24 1.52-7.94 2.37-10.66.56c-3-2-4.42-12.39-4.42-12.39l2-6l9.44-5.53l.56 20.23z" /><path fill="#FFCC80" d="M58.48 4.27C38.43 4.73 22.5 11.73 22.5 20.3c0 8.87 17.05 16.05 38.08 16.05s38.08-7.19 38.08-16.05c0-8.53-15.78-15.51-35.71-16.02" /><path fill="#CE8963" d="M58.48 4.27c-7.17.57-14.32 1.7-20.99 4.16c-3.32 1.21-6.56 2.71-9.27 4.8c-1.33 1.05-2.56 2.23-3.37 3.59c-.84 1.34-1.18 2.84-.94 4.28c.24 1.43 1.05 2.79 2.16 3.95c1.11 1.16 2.45 2.19 3.91 3.05c2.93 1.73 6.22 2.96 9.58 3.89c6.75 1.86 13.83 2.64 20.89 2.63c7.05.02 14.14-.73 20.9-2.57c3.36-.92 6.67-2.13 9.61-3.83c1.47-.85 2.84-1.84 3.96-3c1.13-1.14 2-2.48 2.28-3.91c.33-1.43-.01-2.93-.77-4.29c-.78-1.36-1.97-2.57-3.29-3.63c-2.67-2.13-5.91-3.64-9.22-4.87c-6.65-2.49-13.8-3.64-20.97-4.24c1.8-.03 3.6-.02 5.41.04c1.8.09 3.61.24 5.4.45c3.59.44 7.18 1.09 10.69 2.13c3.49 1.08 6.95 2.47 10.05 4.66c1.55 1.1 2.99 2.44 4.07 4.16c1.07 1.71 1.68 3.93 1.29 6.06c-.34 2.14-1.5 3.97-2.82 5.42c-1.34 1.47-2.9 2.62-4.52 3.62c-3.24 1.98-6.74 3.33-10.28 4.39c-7.12 2.04-14.47 2.84-21.8 2.87c-7.32-.06-14.68-.87-21.79-2.95c-3.54-1.07-7.03-2.45-10.26-4.45c-1.61-1.01-3.15-2.2-4.48-3.69c-1.3-1.48-2.4-3.37-2.68-5.51c-.13-1.06-.06-2.15.21-3.18c.26-1.03.74-1.96 1.29-2.81c1.11-1.7 2.59-2.99 4.14-4.08C30 9.27 33.45 7.89 36.95 6.83c3.51-1.02 7.1-1.66 10.7-2.09c1.8-.2 3.6-.35 5.41-.43c1.81-.08 3.62-.08 5.42-.04z" /><radialGradient id="notoWood1" cx="59.442" cy="16.159" r="21.667" gradientTransform="matrix(-1.1788 0 0 .9412 130.18 -.789)" gradientUnits="userSpaceOnUse"><stop offset=".056" stop-color="#FFA726" /><stop offset=".135" stop-color="#FFA726" /><stop offset="1" stop-color="#FFA726" stop-opacity=".1" /></radialGradient><path fill="url(#notoWood1)" d="M21.91 17.65c0 7.03 14.33 12.73 32.02 12.73s32.02-5.7 32.02-12.73S79.7 2.51 53.93 4.91c-17.61 1.65-32.02 5.7-32.02 12.74z" /><path fill="#7F441C" d="M31.08 18.62c-.01 1.39.81 2.64 1.79 3.61c1.01.96 2.21 1.71 3.46 2.34c2.51 1.24 5.22 2.04 7.95 2.66c5.48 1.15 11.1 1.56 16.68 1.49c5.58-.07 11.18-.63 16.57-1.95c2.68-.68 5.33-1.55 7.75-2.8c1.2-.62 2.33-1.38 3.26-2.26c.9-.9 1.57-1.98 1.54-3.08c-.01-1.09-.69-2.14-1.61-3.01c-.94-.86-2.07-1.58-3.28-2.17c-2.42-1.19-5.07-1.99-7.75-2.61c-2.69-.62-5.43-1.03-8.18-1.31c-2.75-.3-5.53-.44-8.3-.46c-5.55-.04-11.13.24-16.6 1.29c-2.72.56-5.43 1.28-7.95 2.46c-1.25.6-2.45 1.32-3.48 2.25c-.99.93-1.83 2.15-1.85 3.55zm-.22 0c-.02-1.48.83-2.79 1.83-3.79c1.03-1 2.21-1.82 3.47-2.49c2.5-1.37 5.19-2.34 7.93-3.11c5.48-1.52 11.18-2.27 16.87-2.33c2.85-.01 5.7.11 8.54.39c2.84.3 5.66.78 8.45 1.46c2.78.71 5.53 1.61 8.14 2.97c1.3.68 2.55 1.5 3.67 2.57c.54.55 1.05 1.17 1.44 1.89c.39.72.64 1.57.63 2.44c-.01.87-.27 1.71-.67 2.42s-.91 1.32-1.46 1.85c-1.12 1.04-2.38 1.83-3.69 2.47c-2.61 1.29-5.36 2.13-8.14 2.77c-5.56 1.25-11.24 1.71-16.9 1.67c-5.65-.1-11.32-.71-16.79-2.13c-2.73-.71-5.43-1.61-7.94-2.91c-1.26-.64-2.45-1.43-3.49-2.4c-1.01-.98-1.88-2.26-1.89-3.74z" opacity=".66" /><path fill="#B5772C" d="M37.81 17.5c0 3.71 9.66 6.72 21.57 6.72s21.57-3.01 21.57-6.72s-9.66-6.72-21.57-6.72s-21.57 3.01-21.57 6.72zm3.68 0c0-2.78 7.62-5.04 17.03-5.04s17.03 2.26 17.03 5.04s-7.62 5.04-17.03 5.04s-17.03-2.26-17.03-5.04z" opacity=".82" /><linearGradient id="notoWood2" x1="50.85" x2="67.839" y1="16.939" y2="16.939" gradientTransform="matrix(-1 0 0 1 120.75 0)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#8A5140" /><stop offset="1" stop-color="#8A5140" /></linearGradient><ellipse cx="61.41" cy="16.94" fill="url(#notoWood2)" opacity=".74" rx="8.49" ry="2.24" /></svg>
                                    <span className="character-sheet-material-span">{craftingMaterials.wood}</span>
                                </div>
                            </Tooltip>
                            <Tooltip placement="top" title={'Руда'}>
                                <div className="character-sheet-material">
                                    <svg
                                        height="2vh"
                                        width="2vh"
                                        version="1.1"
                                        id="Layer_1"
                                        xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 512 512"
                                        fill="#000000"
                                    >
                                        <path fill="#D6A246" d="M395.13,211.478H261.565l-44.744-73.906l42.631-56.765c0.667-0.89,1.335-1.781,2.114-2.56 c8.348-9.795,20.37-15.249,33.391-15.249c14.136,0,27.046,6.456,35.505,17.809l78.025,103.958 C416.722,195.673,408.932,211.478,395.13,211.478z"></path>
                                        <path fill="#CE8A42" d="M395.13,211.478H261.565V78.247c8.348-9.795,20.37-15.249,33.391-15.249 c14.136,0,27.046,6.456,35.505,17.809l78.025,103.958C416.722,195.673,408.932,211.478,395.13,211.478z"></path>
                                        <path fill="#A78966" d="M87.602,244.87l6.678,33.391l17.35,86.749c1.554,7.805,8.413,13.424,16.37,13.424h267.13 c7.956,0,14.816-5.62,16.37-13.424l17.35-86.749l6.678-33.391H87.602z"></path>
                                        <g>
                                            <path fill="#957856" d="M428.522,411.826H94.609c-9.217,0-16.696-7.473-16.696-16.696l0,0 c0-27.619,22.468-50.087,50.087-50.087h267.13c27.619,0,50.087,22.468,50.087,50.087l0,0 C445.217,404.353,437.739,411.826,428.522,411.826z"></path>
                                            <path fill="#957856" d="M261.565,378.435H395.13c7.956,0,14.816-5.62,16.37-13.424l17.35-86.749l6.678-33.391H261.565 V378.435z"></path>
                                        </g>
                                        <path fill="#816952" d="M395.13,345.043H261.565v66.783h166.957c9.217,0,16.696-7.473,16.696-16.696l0,0 C445.217,367.511,422.749,345.043,395.13,345.043z"></path>
                                        <path fill="#696B6F" d="M161.391,478.609c-27.619,0-50.087-22.468-50.087-50.087s22.468-50.087,50.087-50.087 s50.087,22.468,50.087,50.087S189.01,478.609,161.391,478.609z"></path>
                                        <path fill="#616267" d="M211.478,428.522c0-27.619-22.468-50.087-50.087-50.087v100.174 C189.01,478.609,211.478,456.141,211.478,428.522z"></path>
                                        <path fill="#E7ECFD" d="M161.391,411.826c-9.206,0-16.696,7.49-16.696,16.696c0,9.206,7.49,16.696,16.696,16.696 s16.696-7.49,16.696-16.696C178.087,419.316,170.597,411.826,161.391,411.826z"></path>
                                        <path fill="#DAE0F0" d="M178.087,428.522c0-9.206-7.49-16.696-16.696-16.696v33.391 C170.597,445.217,178.087,437.728,178.087,428.522z"></path>
                                        <path fill="#696B6F" d="M361.739,478.609c-27.619,0-50.087-22.468-50.087-50.087s22.468-50.087,50.087-50.087 s50.087,22.468,50.087,50.087S389.358,478.609,361.739,478.609z"></path>
                                        <path fill="#616267" d="M411.826,428.522c0-27.619-22.468-50.087-50.087-50.087v100.174 C389.358,478.609,411.826,456.141,411.826,428.522z"></path>
                                        <path fill="#E7ECFD" d="M361.739,411.826c-9.206,0-16.696,7.49-16.696,16.696c0,9.206,7.49,16.696,16.696,16.696 c9.206,0,16.696-7.49,16.696-16.696C378.435,419.316,370.945,411.826,361.739,411.826z"></path>
                                        <path fill="#DAE0F0" d="M378.435,428.522c0-9.206-7.49-16.696-16.696-16.696v33.391 C370.945,445.217,378.435,437.728,378.435,428.522z"></path>
                                        <path fill="#957856" d="M495.304,512H16.696C7.479,512,0,504.527,0,495.304s7.479-16.696,16.696-16.696h478.609 c9.217,0,16.696,7.473,16.696,16.696S504.521,512,495.304,512z"></path>
                                        <path fill="#816952" d="M495.304,478.609H261.565V512h233.739c9.217,0,16.696-7.473,16.696-16.696 S504.521,478.609,495.304,478.609z"></path>
                                        <path fill="#F5DC48" d="M261.565,211.478H128c-6.152,0-11.815-3.391-14.718-8.815c-2.913-5.429-2.587-12.016,0.826-17.141 l39-58.5c9.315-13.968,24.891-22.304,41.673-22.304s32.358,8.337,41.673,22.304l39,58.5c3.413,5.124,3.739,11.711,0.826,17.141 C273.38,208.087,267.717,211.478,261.565,211.478z"></path>
                                        <path fill="#FFE477" d="M261.565,211.478H128c-6.152,0-11.815-3.391-14.718-8.815c-2.913-5.429-2.587-12.016,0.826-17.141 l39-58.5c9.315-13.968,24.891-22.304,41.673-22.304s32.358,8.337,41.673,22.304l39,58.5c3.413,5.124,3.739,11.711,0.826,17.141 C273.38,208.087,267.717,211.478,261.565,211.478z"></path>
                                        <path fill="#EDBA43" d="M261.565,164.685v46.793c6.152,0,11.815-3.391,14.718-8.815c2.913-5.429,2.587-12.016-0.826-17.141 L261.565,164.685z"></path>
                                        <path fill="#957856" d="M444.883,198.01l-9.35,46.859l-6.678,33.391H94.275l-6.678-33.391l-9.35-46.859 c-1.003-4.897,0.223-9.906,3.452-13.802c3.115-3.896,7.902-6.122,12.91-6.122h333.913 C438.983,178.087,446.997,187.659,444.883,198.01z"></path>
                                        <path fill="#816952" d="M444.883,198.01l-9.35,46.859l-6.678,33.391h-167.29V178.087h166.957 C438.983,178.087,446.997,187.659,444.883,198.01z"></path>
                                        <path fill="#A78966" d="M461.913,211.478H61.217c-9.217,0-16.696-7.473-16.696-16.696c0-9.223,7.479-16.696,16.696-16.696 h400.696c9.217,0,16.696,7.473,16.696,16.696C478.609,204.005,471.13,211.478,461.913,211.478z"></path>
                                        <path fill="#957856" d="M461.913,178.087H261.565v33.391h200.348c9.217,0,16.696-7.473,16.696-16.696 C478.609,185.56,471.13,178.087,461.913,178.087z"></path>
                                        <path fill="#FFE477" d="M461.913,33.391h-16.696V16.696C445.217,7.473,437.739,0,428.522,0 c-9.217,0-16.696,7.473-16.696,16.696v16.696H395.13c-9.217,0-16.696,7.473-16.696,16.696s7.479,16.696,16.696,16.696h16.696v16.696 c0,9.223,7.479,16.696,16.696,16.696c9.217,0,16.696-7.473,16.696-16.696V66.783h16.696c9.217,0,16.696-7.473,16.696-16.696 S471.13,33.391,461.913,33.391z"></path>
                                        <path fill="#FFB655" d="M445.217,83.478V66.783h16.696c9.217,0,16.696-7.473,16.696-16.696s-7.479-16.696-16.696-16.696 h-16.696V16.696C445.217,7.473,437.739,0,428.522,0v100.174C437.739,100.174,445.217,92.701,445.217,83.478z"></path>
                                        <path fill="#FFE477" d="M94.609,77.913H77.913V61.217c0-9.223-7.479-16.696-16.696-16.696s-16.696,7.473-16.696,16.696 v16.696H27.826c-9.217,0-16.696,7.473-16.696,16.696s7.479,16.696,16.696,16.696h16.696V128c0,9.223,7.479,16.696,16.696,16.696 S77.913,137.223,77.913,128v-16.696h16.696c9.217,0,16.696-7.473,16.696-16.696S103.826,77.913,94.609,77.913z"></path>
                                        <path fill="#FFB655" d="M77.913,128v-16.696h16.696c9.217,0,16.696-7.473,16.696-16.696s-7.479-16.696-16.696-16.696H77.913 V61.217c0-9.223-7.479-16.696-16.696-16.696v100.174C70.435,144.696,77.913,137.223,77.913,128z"></path>
                                    </svg>
                                    <span className="character-sheet-material-span">{craftingMaterials.ore}</span>
                                </div>
                            </Tooltip>
                            <Tooltip placement="top" title={'Кожа'}>
                                <div className="character-sheet-material">
                                    <svg
                                        width='2vh'
                                        height='2vh'
                                        version="1.1"
                                        id="Layer_1"
                                        xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 511.673 511.673"
                                        fill="#000000"
                                    >
                                        <g>
                                            <path fill="#D98F7A" d="M467.699,149.742l-0.168-0.856c-5.579-27.869-21.23-52.71-43.97-69.764l0,0 C312.669,119.949,299.975,8.501,299.975,8.501c-28.337-11.335-59.939-11.335-88.276,0l0,0c0,0-12.685,111.448-123.586,70.621 c-22.74,17.055-38.391,41.896-43.97,69.764l-0.168,0.856c58.65,58.65,58.65,170.867,0,229.517l0.168,0.856 c5.579,27.869,21.23,52.71,43.97,69.764c0,0,123.039-43.034,167.724,61.793c44.694-104.828,167.724-61.793,167.724-61.793l0,0 c22.74-17.055,38.391-41.896,43.97-69.764l0.168-0.856C409.048,320.609,409.048,208.393,467.699,149.742"></path>
                                            <g>
                                                <path fill="#F0EDE0" d="M255.837,457.467c-2.357,0-4.608-0.936-6.268-2.613c-4.846-4.89-10.108-9.41-15.625-13.444 c-3.937-2.878-4.802-8.395-1.924-12.332c2.869-3.937,8.395-4.802,12.332-1.924c3.964,2.895,7.804,6.012,11.485,9.313 c3.681-3.302,7.521-6.418,11.485-9.313c3.937-2.878,9.463-2.013,12.332,1.924c2.878,3.937,2.013,9.454-1.924,12.332 c-5.517,4.034-10.778,8.554-15.625,13.444C260.445,456.531,258.194,457.467,255.837,457.467"></path>
                                                <path fill="#F0EDE0" d="M199.789,423.036c-0.918,0-1.845-0.15-2.763-0.45c-10.699-3.522-22.201-5.906-34.198-7.071 c-4.846-0.468-8.404-4.785-7.927-9.64c0.468-4.846,4.793-8.439,9.64-7.927c13.286,1.289,26.077,3.937,38.012,7.874 c4.634,1.527,7.15,6.515,5.623,11.149C206.949,420.679,203.497,423.036,199.789,423.036"></path>
                                                <path fill="#F0EDE0" d="M97.578,419.703c-2.489,0-4.89-1.05-6.585-2.948c-6.735-7.548-12.103-16.119-15.943-25.485 c-1.192-2.904-0.75-6.223,1.165-8.713c4.193-5.473,8.113-11.326,11.661-17.408c2.463-4.22,7.865-5.632,12.076-3.178 c4.211,2.454,5.632,7.865,3.178,12.076c-3.019,5.164-6.285,10.187-9.737,14.98c2.119,4.308,4.661,8.369,7.601,12.156 c5.729-1.086,11.546-1.969,17.337-2.639c4.873-0.583,9.225,2.913,9.781,7.751c0.565,4.846-2.913,9.225-7.751,9.781 c-7.018,0.821-14.062,1.977-20.948,3.434C98.805,419.641,98.187,419.703,97.578,419.703"></path>
                                                <path fill="#F0EDE0" d="M121.566,249.842c-4.458,0-8.289-3.363-8.775-7.901c-1.324-12.597-3.769-25-7.265-36.855 c-1.377-4.679,1.298-9.587,5.976-10.964c4.67-1.395,9.587,1.289,10.964,5.967c3.796,12.888,6.453,26.342,7.892,39.998 c0.503,4.846-3.01,9.198-7.857,9.71C122.184,249.824,121.875,249.842,121.566,249.842 M114.009,335.249 c-0.83,0-1.668-0.124-2.507-0.371c-4.67-1.368-7.345-6.285-5.967-10.955c3.496-11.873,5.941-24.267,7.256-36.864 c0.512-4.846,4.776-8.342,9.702-7.857c4.855,0.512,8.369,4.855,7.865,9.702c-1.439,13.656-4.087,27.118-7.883,40.007 C121.336,332.759,117.823,335.249,114.009,335.249"></path>
                                                <path fill="#F0EDE0" d="M95.514,168.233c-3.037,0-5.994-1.562-7.636-4.378c-3.549-6.082-7.468-11.944-11.661-17.408 c-1.916-2.489-2.357-5.809-1.165-8.722c3.716-9.057,8.872-17.382,15.307-24.761c2.18-2.481,5.526-3.558,8.766-2.754 c7.027,1.739,13.939,2.966,20.551,3.663c4.846,0.512,8.369,4.864,7.848,9.71c-0.503,4.838-4.793,8.289-9.702,7.857 c-5.667-0.6-11.511-1.554-17.443-2.825c-2.675,3.566-5.014,7.353-6.983,11.352c3.452,4.802,6.718,9.825,9.737,14.989 c2.454,4.211,1.033,9.613-3.178,12.076C98.559,167.845,97.023,168.233,95.514,168.233"></path>
                                                <path fill="#F0EDE0" d="M168.38,126.846c-3.716,0-7.168-2.366-8.395-6.091c-1.51-4.634,1.024-9.613,5.65-11.132 c12.103-3.955,23.128-10.328,32.794-18.944c3.628-3.257,9.216-2.931,12.456,0.715c3.249,3.637,2.931,9.216-0.706,12.465 c-11.485,10.249-24.629,17.832-39.053,22.546C170.216,126.705,169.289,126.846,168.38,126.846"></path>
                                                <path fill="#F0EDE0" d="M233.69,65.915c-1.271,0-2.56-0.274-3.778-0.847c-4.405-2.092-6.285-7.353-4.193-11.758 c2.94-6.206,5.464-12.729,7.495-19.377c0.98-3.187,3.663-5.553,6.947-6.118c10.258-1.766,21.08-1.766,31.356,0 c3.284,0.565,5.967,2.931,6.939,6.118c2.039,6.647,4.555,13.162,7.495,19.377c2.092,4.405,0.212,9.666-4.202,11.758 c-4.396,2.092-9.657,0.212-11.75-4.202c-2.507-5.288-4.732-10.77-6.665-16.358c-4.961-0.486-10.028-0.486-14.998,0 c-1.924,5.597-4.158,11.079-6.665,16.358C240.161,64.052,236.992,65.915,233.69,65.915"></path>
                                                <path fill="#F0EDE0" d="M343.328,126.863c-0.909,0-1.827-0.141-2.737-0.441c-14.424-4.705-27.569-12.288-39.071-22.537 c-3.637-3.24-3.955-8.819-0.715-12.465c3.249-3.637,8.819-3.955,12.465-0.715c9.666,8.616,20.701,14.989,32.794,18.935 c4.634,1.51,7.168,6.497,5.658,11.132C350.505,124.497,347.044,126.863,343.328,126.863"></path>
                                                <path fill="#F0EDE0" d="M416.16,168.233c-1.509,0-3.046-0.388-4.44-1.201c-4.211-2.463-5.632-7.865-3.178-12.076 c3.019-5.164,6.285-10.187,9.737-14.989c-1.969-3.999-4.308-7.795-6.991-11.352c-5.914,1.271-11.758,2.225-17.434,2.825 c-4.899,0.424-9.198-3.019-9.71-7.857c-0.512-4.846,3.001-9.198,7.857-9.71c6.621-0.697,13.533-1.933,20.542-3.672 c3.222-0.794,6.594,0.274,8.766,2.763c6.444,7.371,11.599,15.704,15.316,24.761c1.192,2.913,0.75,6.232-1.165,8.722 c-4.193,5.464-8.113,11.326-11.661,17.408C422.154,166.671,419.196,168.233,416.16,168.233"></path>
                                                <path fill="#F0EDE0" d="M390.108,249.845c-0.309,0-0.618-0.018-0.927-0.044c-4.855-0.512-8.369-4.855-7.865-9.702 c1.439-13.656,4.087-27.118,7.883-40.007c1.386-4.679,6.321-7.345,10.973-5.967c4.67,1.368,7.345,6.276,5.967,10.955 c-3.496,11.864-5.941,24.267-7.256,36.855C398.397,246.473,394.566,249.845,390.108,249.845 M397.673,335.243 c-3.814,0-7.336-2.489-8.466-6.329c-3.796-12.888-6.453-26.341-7.892-39.998c-0.503-4.855,3.01-9.198,7.857-9.71 c4.882-0.494,9.198,3.01,9.71,7.857c1.324,12.597,3.769,25,7.265,36.855c1.377,4.679-1.298,9.587-5.976,10.964 C399.341,335.129,398.503,335.243,397.673,335.243"></path>
                                                <path fill="#F0EDE0" d="M414.095,419.703c-0.609,0-1.227-0.062-1.836-0.194c-6.886-1.457-13.93-2.613-20.948-3.434 c-4.838-0.556-8.316-4.935-7.751-9.781c0.556-4.846,4.97-8.342,9.781-7.751c5.791,0.671,11.608,1.554,17.337,2.639 c2.94-3.787,5.482-7.848,7.601-12.156c-3.452-4.793-6.718-9.816-9.737-14.98c-2.454-4.211-1.033-9.622,3.178-12.076 c4.211-2.454,9.613-1.042,12.076,3.178c3.549,6.082,7.468,11.935,11.661,17.408c1.916,2.489,2.357,5.809,1.165,8.713 c-3.84,9.366-9.207,17.938-15.943,25.485C418.986,418.653,416.584,419.703,414.095,419.703"></path>
                                                <path fill="#F0EDE0" d="M311.91,423.027c-3.708,0-7.159-2.357-8.386-6.065c-1.527-4.635,0.989-9.622,5.623-11.149 c11.935-3.937,24.726-6.585,38.02-7.874c4.864-0.494,9.172,3.081,9.631,7.927c0.477,4.855-3.072,9.172-7.927,9.64 c-11.997,1.165-23.499,3.549-34.198,7.071C313.755,422.877,312.828,423.027,311.91,423.027"></path>
                                            </g>
                                        </g>
                                    </svg>
                                    <span className="character-sheet-material-span">{craftingMaterials.leather}</span>
                                </div>
                            </Tooltip>
                            <Tooltip placement="top" title={'Травы'}>
                                <div className="character-sheet-material">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="2vh" height="2vh" viewBox="0 0 128 128"><path fill="#5B9821" d="M84.5 37.89s-10.95 2.89-26.19 25.75c-11.77 17.65-12.95 31.48-22.8 40.75c-5.01 4.71-13.09 7.94-13.09 7.94s-6.47-.15-6.91.15c-.44.29-1.73 3.53.69 7.51c2 3.29 5.05 4.12 6.08 4.26c1.03.15 2.94-4.27 3.68-4.86c.74-.59 9.43-3.93 15.6-10.74c12.65-13.98 12.45-26.11 21.63-42.08c10.15-17.65 22.66-26.19 22.66-26.19l-1.35-2.49z"/><path fill="#5B9821" d="M122.69 3.39c-.39-.43-25.34-.05-38.15 11.52c-15.22 13.74-11.1 32.76-11.1 32.76s17.77 4.21 31.18-7.93c15.64-14.15 18.46-35.92 18.07-36.35zM72.4 70.49c.82.64 2 1.39 3.69 2.23c9.56 4.78 21.5 2.16 27.35-.16c8.13-3.23 20.21-12.95 20.21-13.69c0-.74-5.5-3.38-13.32-5.71s-18.27-2.44-26.21.95c-7.28 3.11-10.67 8.58-12.54 11.86c0 0-2.9.46-5 .82c-3.7.63-6.55 1.9-6.55 1.9l-2.85 5.92s5.81-2.64 8.77-3.28s6.45-.84 6.45-.84zM54.31 8.73c-.93.19-5.33 7.06-8.03 13.63c-2.13 5.17-4.26 18.38-.45 26.52s8.22 9.68 8.22 9.68s.54 2.37.48 5.55c-.03 1.8-.21 6.76-.21 6.76l4.35-1.89s.29-4.16.27-6.18c-.03-2.13-.29-4.82-.29-4.82s7.19-6.73 7.72-17.18c.42-8.24-.46-15.89-5-24.14c-3.56-6.43-6.53-8.03-7.06-7.93zM5.8 24.95c-1.08 1.23 1.37 4.33 1.59 11.31c.17 5.71 1.16 25.05 6.87 34.98s13.63 12.37 16.17 13.21c2.54.85 8.03.95 8.03.95s2.33 2.01 3.17 4.86c.85 2.85 1.69 7.08 1.69 7.08l4.02-5.92s-1.16-4.65-2.33-6.76c-1.16-2.11-1.59-2.85-1.59-2.85s2.57-15.99-1.8-29.17C36.45 37 27.57 31.08 19.33 27.59S6.54 24.11 5.8 24.95zm44.5 68.06s1.89-1.15 5.27-1.23c3.11-.07 5.04.51 5.04.51s5.81-6.67 12.31-8.58c6.13-1.8 14.22-3.41 28.47 2.5c14.27 5.92 22.47 11.66 22.37 13.46c-.11 1.8-14.13 8.22-19.94 10.22c-5.81 2.01-19.14 6.23-31.64 1.4c-9.93-3.84-12.15-13-12.15-13s-2.3-1.27-4.94-1.12c-4.83.26-8.9 3.87-8.9 3.87l4.11-8.03z"/><path fill="#8DC02C" d="M77.97 38.72c1.57.97 5.5-8.88 9.3-13.42s10.89-9.19 10.15-11.2s-9.09.85-14.8 8.24c-5.7 7.4-6.02 15.54-4.65 16.38zm1.07 24.81c1.14 1.57 6.37-2.17 11.63-3.38c5.41-1.25 11.2.51 10.99-2.43c-.2-2.78-7.93-3.06-13-1.69s-10.99 5.59-9.62 7.5zM50.51 48.58c1.93-.08 1.27-6.02 1.37-11.63s1.06-14.06-1.06-14.16c-2.11-.11-3.89 5.47-4.02 12.15c-.1 5.5 1.17 13.74 3.71 13.64zM12.14 38.06c-1.27.42-.37 3.38-.32 4.76c.32 9.09 3.38 23.15 8.35 29.28c3.86 4.76 8.24 8.24 11.2 6.13c2.96-2.11-2.67-6.67-5.5-11.2c-4.54-7.29-7.4-16.59-8.88-21.14s-2.46-8.63-4.85-7.83z"/><path fill="#8DC02D" d="M67.41 92.04c.19 2.77 6.21 1.32 12.59.69s11.63-1.51 11.38-3.85c-.23-2.18-7.36-2.41-12.99-2.01c-5.63.4-11.15 2.7-10.98 5.17z"/></svg>
                                    <span className="character-sheet-material-span">{craftingMaterials.herbs}</span>
                                </div>
                            </Tooltip>
                            <Tooltip placement="top" title={'Кристаллы'}>
                                <div className="character-sheet-material">
                                    <svg width="2vh" height="2vh" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd" clip-rule="evenodd"><path fill="#fff" d="M19.059 10.609c-.17-.54-2.87-3.39-3.9-3.67q-1.046-.09-2.09 0a30 30 0 0 0-3.53.06c-.41 0-1.26-.15-1.61.22a27 27 0 0 0-2.07 2.1c-.42.436-.791.916-1.11 1.43c-.19.4.18.78.45 1.25s1.57 2.65 2.8 4.63c.77 1.26 2.22 2.65 2.64 3.27a.292.292 0 0 0 .5-.3a25 25 0 0 0-.18-4.6a18 18 0 0 0-1-3.12c1.264.164 2.545.164 3.81 0q-.278.67-.64 1.3a20.3 20.3 0 0 0-1.28 3.82a.33.33 0 0 0 .6.28a20.7 20.7 0 0 0 2-4.77a2.4 2.4 0 0 0 .2-.69c1.14-.14 2.27-.3 3.39-.38c-.39.86-5.47 7.51-6.21 7.9a.334.334 0 0 0 .31.59c.83-.41 4.72-5.27 5.29-6c.67-.93 1.96-2.22 1.63-3.32m-4.63-2.61c.43 0 .58 0 1.11.44a11 11 0 0 0-1.18 1.77a21 21 0 0 0-1.59-1.63a6 6 0 0 1-.7-.57q.435-.022.87 0q.745.039 1.49-.01m-4.89.1c1.53 0 1.42-.16 1.3.08c-.08.08-1.79 1.79-1.89 2a9 9 0 0 0-.56-1.91a2.17 2.17 0 0 1 1.15-.18zm-.25 4c.67 4.43.62 2.18 1.1 6.63c-1.39-1.66-1.47-1.73-4.39-7.18c0 0-.24-.28-.35-.46c.2-.31.75-.85 1-1.13q.564-.642 1.21-1.2a10 10 0 0 0 .44 2.1h-1.49c-.88-.17-.91.48-.54.59l3 .32c-.01.13.02.23.02.28zm.28-1.2c.4-.47 1.71-1.45 2-1.81c.74.58 1.89 1.62 2 1.79a36 36 0 0 1-4-.03zm5.49-.09a9.6 9.6 0 0 1 1-1.87a23 23 0 0 1 1.94 1.77c-1-.02-2 0-2.94.05z"/><path fill="#0c6fff" d="M3.868 5.748a.332.332 0 0 0 .57-.34c-.16-.41-.29-.8-.44-1.18a3.3 3.3 0 0 0-1.29-1.29c-.24-.12-.34.1-.39.16c-.41.57 1.48 2.57 1.55 2.65m16.262-.04c1.42-1.6.67-.48 1.5-2.3c.08-.18.08-.3.05-.35s-.15-.28-.39-.16c-.543.301-.99.748-1.29 1.29c-.19.38-.32.76-.48 1.17a.352.352 0 1 0 .61.35M3.939 13.539c.3 0 .51-.37.13-.67a3.6 3.6 0 0 0-1.58-.49c-.46 0-2.25.07-2.46.47c-.07.12 0 .22.09.34c.27.29 3.26.35 3.82.35M24 12.809a4.75 4.75 0 0 0-3.43-.27a3.4 3.4 0 0 0-.61.28c-.37.29-.18.68.13.68a12 12 0 0 0 3.41-.26a3 3 0 0 0 .41-.1c.09-.14.09-.21.09-.33M5.209 17.55c-1.32 1.14-.75.11-3.2 3.2c-.08.17 0 .51.43.34A9.65 9.65 0 0 0 5.709 18a.34.34 0 0 0-.5-.45m14.961 1c-.44-.39-1-.67-1.38-1.05s-.8.13-.5.45q.846 1.156 1.86 2.17c.18.17 1.4 1 1.63 1s.32-.15.21-.38c.01-.08-1.53-1.94-1.82-2.19"/></g></svg>
                                    <span className="character-sheet-material-span">{craftingMaterials.crystals}</span>
                                </div>
                            </Tooltip>
                            <Tooltip placement="top" title={'Реликвии'}>
                                <div className="character-sheet-material">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="1.6vh" height="1.6vh" viewBox="0 0 512 512"><path fill="#fff" d="M499.78 16.125L477.157 22.5l-151.47 42.53l-6.592 1.876l-.22 6.844l-.905 29.344l-18.814 5.03l-6.656 1.75l-.28 6.907l-.97 24.657l-134.125 133.594l-2.875 2.876l.125 4.063c.71 20.398-14.288 31.957-22.75 31.217c-9.973-.872-15.33-4.037-18.875-8.437c-3.544-4.4-5.546-10.93-5.5-19.656l.125-24.156l-16.344 17.78c-17.327 18.843-26.697 42.824-26.843 66.97l-.062 9.406h9.406c12.214.003 24.46 2.815 35.72 8.344l-4.063 14.468c-20.925 17.263-41.855 40.54-52.968 59.97c-1.636 2.857-2.977 5.514-4.064 7.968L16.25 454.75l-1.5 41.656l41.656-1.5l9-32.187a88.36 88.36 0 0 0 7.72-3.94c19.338-11.062 42.48-31.857 59.718-52.686l14.47-4.063c5.345 11.147 8.143 23.224 8.186 35.064l.03 9.312h9.314c24.72.007 49.722-9.366 68.844-27.53l13.906-13.22l-19-2.78c-10.576-1.556-18.374-5.412-23.03-9.75c-4.66-4.34-6.335-8.744-5.876-13.626c1.054-11.204 4.174-16.044 8.437-19.063c4.263-3.018 11.267-4.52 21.094-4.218l4.06.124l2.845-2.875l136.313-136.314l18.968-.47l6.938-.186l1.844-6.688l4.437-16.093l32.906-1.44l6.75-.28l1.845-6.53L491.75 36.624l8.03-20.5zM466.157 45L429.97 173.906L397 175.312l-6.78.282l-1.814 6.594l-4.406 16l-15.75.375l-3.72.093l-2.655 2.625l-136.28 136.314c-9.812.1-19.142 1.668-27.064 6.812l.69-19.25l144.343-144.344l26.437-1.03L374.625 163l1.844-6.656l6.905-.188l32.25-.937l22.938-82.595l-82.594 22.938L355 125.5l-.22 6.875l-6.655 1.844l-19.03 5.186l-.876 30.344l-142.25 142.22l-21.19.75c4.803-7.545 7.843-16.86 8.22-27.158l134-133.437l2.625-2.594l.125-3.655l.875-21.47l18.875-5.03l6.72-1.813l.186-6.937l.938-29.438L466.156 45zM93.03 307.78c1.38 3.076 3.004 6.015 5.157 8.69c4.966 6.163 11.98 10.684 20.5 13.217l-4.343 15.5a100.193 100.193 0 0 0-30.844-8.25c1.23-10.044 4.448-19.957 9.53-29.156zm87.25 23.095l-1.53 42.97l-57.5 16.092l16.063-57.53l42.968-1.532zm2.657 61.22c2.006 5.516 5.43 10.576 9.875 14.717c3.934 3.665 8.684 6.685 14.032 9.094c-10.278 6.204-21.67 9.998-33.188 11.28c-1.086-10.328-3.84-20.554-8.125-30.248l17.407-4.844z"/></svg>
                                    <span className="character-sheet-material-span">{craftingMaterials.relics}</span>
                                </div>
                            </Tooltip>
                        </div>
                        <Button onClick={() => toggleDeleteModal(true)} type="primary" danger ghost style={{ fontSize: '0.75rem' }}>
                            Удалить персонажа
                        </Button>
                    </div>
                </div>
                <ModalDelete
                    open={isDeleteModalOpen}
                    onCancel={() => toggleDeleteModal(false)}
                    onOk={handleReset}
                />

                <Divider style={{ borderColor: 'white', color: 'white', margin: 0, fontFamily: 'Cormorant', fontSize: 23 }}>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 48 48"><path fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" d="M42.65 34.75v-21.5L24 2.5L5.35 13.25v21.5L24 45.5z" /><path fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" d="m36.31 32.45l6.34-19.2L24 10.59L5.35 13.25l6.34 19.2L24 45.5z" /><path fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" d="M36.31 32.45H11.69L24 10.59zM24 10.59V2.5m12.31 29.95l6.34 2.3m-30.96-2.3l-6.34 2.3" /></svg>
                </Divider>

                <DragOverlay>
                    {activeItemData ? (
                        <div className="draggableItem overlay">
                            <img
                                src={ITEM_IMAGES[activeItemData.item.img as keyof typeof ITEM_IMAGES]}
                                alt={activeItemData.item.name}
                                className="draggableItem-img"
                            />
                        </div>
                    ) : null}
                </DragOverlay>

            </DndContext>
        </div>
    )
}
